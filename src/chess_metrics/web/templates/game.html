{% extends "base.html" %}

{% block title %}Game #{{ game_id }} - Chess Metrics Engine{% endblock %}

{% block content %}
<div id="loading" class="text-center py-5">
    <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<div id="gameContent" style="display: none;">
    <div class="row mb-3">
        <div class="col-12">
            <h2 id="gameTitle"></h2>
            <p class="text-muted" id="gameInfo"></p>
        </div>
    </div>
    
    <div class="row">
        <!-- Left column: Chessboard -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body">
                    <div id="board" style="width: 100%; max-width: 500px; margin: 0 auto;"></div>
                    
                    <div class="text-center mt-3">
                        <div class="btn-group" role="group">
                            <button id="btnFirst" class="btn btn-secondary">⏮️ First</button>
                            <button id="btnPrev" class="btn btn-secondary">◀️ Prev</button>
                            <button id="btnNext" class="btn btn-secondary">▶️ Next</button>
                            <button id="btnLast" class="btn btn-secondary">⏭️ Last</button>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <p class="mb-1"><strong>Current Move:</strong> <span id="currentMove">Start</span></p>
                        <p class="mb-0"><strong>FEN:</strong> <small id="currentFen" class="font-monospace"></small></p>
                    </div>
                </div>
            </div>
            
            <!-- Move List -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="mb-0">Moves</h5>
                </div>
                <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                    <div id="moveList"></div>
                </div>
            </div>
        </div>
        
        <!-- Right column: Metrics and Analysis -->
        <div class="col-lg-6">
            <!-- Position Metrics and Analysis Summary side by side -->
            <div class="row mb-3">
                <!-- Position Metrics (Left) -->
                <div class="col-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Position Metrics</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-sm mb-0">
                                <thead>
                                    <tr>
                                        <th>Metric</th>
                                        <th>White</th>
                                        <th>Black</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="metric-label metric-pv">Material (PV)</span></td>
                                        <td id="pv_w" class="metric-value">-</td>
                                        <td id="pv_b" class="metric-value">-</td>
                                    </tr>
                                    <tr>
                                        <td><span class="metric-label metric-mv">Mobility (MV)</span></td>
                                        <td id="mv_w" class="metric-value">-</td>
                                        <td id="mv_b" class="metric-value">-</td>
                                    </tr>
                                    <tr>
                                        <td><span class="metric-label metric-ov">Offense (OV)</span></td>
                                        <td id="ov_w" class="metric-value">-</td>
                                        <td id="ov_b" class="metric-value">-</td>
                                    </tr>
                                    <tr>
                                        <td><span class="metric-label metric-dv">Defense (DV)</span></td>
                                        <td id="dv_w" class="metric-value">-</td>
                                        <td id="dv_b" class="metric-value">-</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Analysis Summary (Right) -->
                <div class="col-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Analysis Summary</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-sm mb-0">
                                <thead>
                                    <tr>
                                        <th>Error Type</th>
                                        <th>White</th>
                                        <th>Black</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="error-label error-blunder" style="background-color: #dc3545 !important; color: #ffffff !important;">Blunders</span></td>
                                        <td id="blunders_w">-</td>
                                        <td id="blunders_b">-</td>
                                    </tr>
                                    <tr>
                                        <td><span class="error-label error-mistake" style="background-color: #fd7e14 !important; color: #ffffff !important;">Mistakes</span></td>
                                        <td id="mistakes_w">-</td>
                                        <td id="mistakes_b">-</td>
                                    </tr>
                                    <tr>
                                        <td><span class="error-label error-inaccuracy" style="background-color: #ffc107 !important; color: #000000 !important;">Inaccuracies</span></td>
                                        <td id="inaccuracies_w">-</td>
                                        <td id="inaccuracies_b">-</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Metrics Chart -->
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">Metric Progression</h5>
                </div>
                <div class="card-body">
                    <canvas id="metricsChart"></canvas>
                    <div class="mt-3">
                        <div class="row">
                            <div class="col-md-6">
                                <small class="text-muted">
                                    <strong>Metric Colors:</strong><br>
                                    <span class="metric-label metric-pv metric-toggle active" data-metric="pv">Material (PV)</span>
                                    <span class="metric-label metric-mv metric-toggle" data-metric="mv">Mobility (MV)</span>
                                    <span class="metric-label metric-ov metric-toggle" data-metric="ov">Offense (OV)</span>
                                    <span class="metric-label metric-dv metric-toggle" data-metric="dv">Defense (DV)</span>
                                </small>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted">
                                    <strong>Error Highlighting:</strong><br>
                                    <span class="error-label error-blunder error-toggle active" data-error="blunder" style="background-color: #dc3545 !important; color: #ffffff !important; font-size: 0.75rem; padding: 4px 8px;">Blunder</span>
                                    <span class="error-label error-mistake error-toggle active" data-error="mistake" style="background-color: #fd7e14 !important; color: #ffffff !important; font-size: 0.75rem; padding: 4px 8px;">Mistake</span>
                                    <span class="error-label error-inaccuracy error-toggle active" data-error="inaccuracy" style="background-color: #ffc107 !important; color: #000000 !important; font-size: 0.75rem; padding: 4px 8px;">Inaccuracy</span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="error" class="alert alert-danger" style="display: none;"></div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/game_viewer.js') }}?v=102"></script>
<script>
    const gameId = {{ game_id }};
    initGameViewer(gameId);
</script>
{% endblock %}

